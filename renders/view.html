<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <base href="/">
    <!-- comment ou when shifting to electron -->
    <meta http-equiv='X-UA-Compatible' content='ie=edge'>
    <title>PorjectTitle</title>
    <link rel="stylesheet" href="css/table-style.css">
    <!-- <link rel="stylesheet" href="../assets/css/table-style.css"> -->
</head>

<body>
    <main class="max-widthwrapper">
        <div class="view-header">
            <div class="page-header">
                <%=data.cmlnum%> - <%=data.filekeyNum%>
            </div>

            <div class="action-cell">
                <a href="#" class="open-link" onclick="()=>{addNewRow()}">Add New</a>
                <a href="/" class="open-link">Go Back</a>
            </div>
        </div>

        <table class="view-table">
            <thead>
                <th>
                    S. No
                </th>
                <th>
                    File Name
                </th>
                <th>
                    Actions
                </th>
            </thead>
            <tbody id="table-rows">

                <% for(let i=0 ; i < data.tableRows.length ; i++) { %>
                    <tr>
                        <td>
                            <%= i+1 %>.
                        </td> 
                        <td>
                            <%= data.tableRows[i].filename %>
                        </td>
                        <td class="actions-cell">
                            <div class="action-button-container">
                                <a href="http://localhost:3000/removeFile?=<%=data.cmlNum%> &fileDocType= <%=data.filekeyNum%>&fileName= <%=data.tableRows[i].filename%>">Delete File</a></div>
                                <div>
                                    <a href=<%=data.tableRows[i].url%> target="_blank" class="open-link">
                                        View
                                    </a>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <% }%>
            </tbody>
        </table>
    </main>

    <script type="text/javascript">
        function removeFile(button) {
            const cmlNum = button.getAttribute('data-cmlnum');
            const fileDocType = button.getAttribute('data-filedoctype');
            const fileName = button.getAttribute('data-filename');

            fetch(`/removeFile?cmlNum=${cmlNum}&fileDocType=${fileDocType}&fileName=${fileName}`)
            .then(response => {
                if (response.ok) {
                    console.log('File removed successfully');
                    window.location.href = '/'; 
                } else {
                    console.error('Failed to remove file');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>
</body>

</html>